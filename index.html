<!DOCTYPE html>
<html>
<head>
<title>How to make HTML 5 Games</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">


<script type="text/javascript">

window.onload = function() { 

test_collison_between_entities = function(entity1, entity2) {
	var rect1 = {
		x: entity1.x - entity1.width / 2,
		y: entity1.y - entity1.height / 2, // Dont understand why he made these half values by doing - half width,
		width: entity1.width,
		height: entity1.height
	}

	var rect2 = {
		x: entity2.x - entity2.width / 2,  // Dont understand why he made these half values by doing - half width,
		y: entity2.y - entity2.height / 2, 
		width: entity2.width,
		height: entity2.height
	}
	return test_collision_between_rectangles(rect1, rect2);
}

test_collision_between_rectangles = function(rect1, rect2) { // Returns true if collinding and false if not colliding
	return rect1.x <= rect2.x + rect2.width
	&& rect2.x <= rect1.x + rect1.width
	&& rect1.y <= rect2.y + rect2.height
	&& rect2.y <= rect1.y + rect1.height;
}

get_distance_between_entities = function(entity1, entity2) {
	var vx = entity1.x - entity2.x;
	var vy = entity1.y -entity2.y;
	return Math.sqrt(vx * vx + vy * vy);
}

enemy = function(x, y, spd_x, spd_y, id, width, height) {
	// Enemy3
	var enemy3 = {
		x: x,
		y: y,
		spd_x: spd_x,
		spd_y: spd_y,
		id: id,
		width: width,
		height: height,
		colour: "red"
	};
	enemy_list[id] = enemy3;
}

document.onmousemove = function(mouse) {
	var mouse_x = mouse.clientX - document.getElementById("canvas").getBoundingClientRect().left;
	var mouse_y = mouse.clientY - document.getElementById("canvas").getBoundingClientRect().top;

	if(mouse_x < player.width / 2)
		mouse_x = player.width / 2;
	if(mouse_x > CANVAS_WIDTH - player.width / 2)
		mouse_x = CANVAS_WIDTH - player.width / 2;
	if(mouse_y < player.height / 2)
		mouse_y = player.height / 2;
	if(mouse_y > CANVAS_HEIGHT - player.height / 2)
		mouse_y = CANVAS_HEIGHT - player.height / 2;

	player.x = mouse_x;
	player.y = mouse_y;
}

update_entity = function(entity) {
	update_entity_position(entity);
	draw_entity(entity);
}

clear_canvas = function() {
	ctx.clearRect(0, 0, 640, 480);
}

update_entity_position = function(entity) {
	entity.y += entity.spd_y;
	entity.x += entity.spd_x;

	if(entity.x <= 0 || entity.x >= CANVAS_WIDTH) {
		console.log(message)
		entity.spd_x = -entity.spd_x;
	}

	if(entity.y <= 0 || entity.y >= CANVAS_HEIGHT) {
		console.log(message);
		entity.spd_y = -entity.spd_y;
	}
}

draw_entity = function(entity) {
	ctx.save();
	ctx.fillStyle = entity.colour;
	ctx.fillRect(entity.x - entity.width / 2, entity.y - entity.height / 2, entity.width, entity.height);
	ctx.restore();
}

draw_score = function() {
	ctx.fillText("Health: " + player.hp, 0, 30);
}

generate_enemy = function() {
	// Math.random() generates a number between 0 and 1
	var x = Math.random() * CANVAS_WIDTH;
	var y = Math.random() * CANVAS_HEIGHT;
	var width = 10 + Math.random() * 40;
	var height = 10 + Math.random() * 40;
	var id = Math.random();
	var spd_x = 5 + Math.random() * 2;
	var spd_y = 5 + Math.random() * 2

	console.log(width);
	console.log(height);
	console.log(spd_x);

	enemy(x, y, spd_x, spd_y, id, width, height);
}

start_new_game = function() {
	// Restart score counter
	time_game_started = Date.now();
	player.hp = 10;

	// Clear enemies then create them
	enemy_list = {};
	generate_enemy();
	generate_enemy();
	generate_enemy();
}

update_canvas = function() {
	clear_canvas();
	frame_count++;

	if(frame_count % 100 === 0)
		generate_enemy();

	for(var key in enemy_list) {
		update_entity(enemy_list[key]);	

		var is_colliding = test_collison_between_entities(player, enemy_list[key]);
		if(is_colliding) {
			console.log("Player Collided");
			player.hp -= 1;
		}
	}

	if(player.hp <= 0) {
		var time_survived = Date.now() - time_game_started;
		console.log("Your score is: " + time_survived + "ms");
	
		start_new_game();
	}

	draw_entity(player);
	draw_score();
}

/////////////////////////////////////////////////////////////

var ctx = document.getElementById("canvas").getContext("2d");

ctx.font = "20px Arial";

var message = "Hit Wall!";

var CANVAS_HEIGHT = 480;
var CANVAS_WIDTH = 640;
var time_game_started = Date.now(); // current time

// Player
var player = {
	x: 250,
	y: 250,
	spd_x: 5,
	spd_y: 5,
	hp: 10,
	width: 20,
	height: 20,
	colour: "green"
};

var frame_count = 0;

var enemy_list = {};
start_new_game();

setInterval(update_canvas, 25);

}; // End of onload

</script>
</head>

<body>
<canvas id="canvas" width="640" height="480"></canvas>
</body>
</html>